
const propertiesData=[{

    "_id": {
      "$oid": "66b8c19316cc840f1c66c5cd"
    },
    "owner": {
      "$oid": "66a416a84da064e1d8fe6b0d"
    },
    "name": "Lisiting 1",
    "type": "Apartment",
    "description": "Pariatur Ut ut at i",
    "location": {
      "street": "Soluta sint in opti",
      "city": "Laboris harum omnis ",
      "state": "Nisi dolore dolorem ",
      "zipcode": "17623"
    },
    "beds": 2,
    "baths": 10,
    "square_feet": 1500,
    "amenities": [
      "Full Kitchen",
      "Washer & Dryer",
      "Swimming Pool",
      "Hot Tub",
      "24/7 Security",
      "Elevator Access",
      "Dishwasher",
      "Gym/Fitness Center",
      "Air Conditioning",
      "Balcony/Patio",
      "Coffee Maker"
    ],
    "rates": {
      "nightly": 41,
      "weekly": 4,
      "monthly": 5
    },
    "seller_info": {
      "name": "Jeanette Snow",
      "email": "nemefowem@mailinator.com",
      "phone": "+1 (608) 216-7416"
    },
    "images": [
      "https://res.cloudinary.com/dlleddoro/image/upload/v1723384210/InTheMarket/drrfprlyuej86zs7lgfr.jpg",
      "https://res.cloudinary.com/dlleddoro/image/upload/v1723384211/InTheMarket/k91zvct3rmnigvqrhmeh.jpg",
      "https://res.cloudinary.com/dlleddoro/image/upload/v1723384211/InTheMarket/rwyc3rojpcukhe923bob.jpg"
    ],
    "is_featured": false,
    "createdAt": {
      "$date": "2024-08-11T13:50:11.986Z"
    },
    "updatedAt": {
      "$date": "2024-08-11T13:50:11.986Z"
    },
    "__v": 0
  },
  {
    "_id": {
      "$oid": "66b900d016cc840f1c66c5f2"
    },
    "owner": {
      "$oid": "66a416a84da064e1d8fe6b0d"
    },
    "name": "Boston Commons Retreat",
    "type": "Apartment",
    "description": "This is a beautiful apartment located near the commons. It is a 2 bedroom apartment with a full kitchen and bathroom. It is available for weekly or monthly rentals.",
    "location": {
      "street": "120 Tremont Street",
      "city": "Boston",
      "state": "MA",
      "zipcode": "02108"
    },
    "beds": 2,
    "baths": 1,
    "square_feet": 1500,
    "amenities": [
      "Wifi",
      "Full Kitchen",
      "Washer & Dryer",
      "Swimming Pool",
      "Hot Tub",
      "24/7 Security",
      "Wheelchair Accessible",
      "Elevator Access",
      "Dishwasher",
      "Gym/Fitness Center",
      "Air Conditioning",
      "Balcony/Patio",
      "Smart TV"
    ],
    "rates": {
      "nightly": null,
      "weekly": 1100,
      "monthly": 4200
    },
    "seller_info": {
      "name": "Jhon Doe",
      "email": "john@gmail.com",
      "phone": "617-555-5555"
    },
    "images": [
      "https://res.cloudinary.com/dlleddoro/image/upload/v1723400399/InTheMarket/ccjr2c9tvdcwdumithp7.jpg",
      "https://res.cloudinary.com/dlleddoro/image/upload/v1723400400/InTheMarket/dozjcyewrgigsnhad4um.jpg",
      "https://res.cloudinary.com/dlleddoro/image/upload/v1723400400/InTheMarket/cy4wmhxx6kpfk89yk3wz.jpg"
    ],
    "is_featured": false,
    "createdAt": {
      "$date": "2024-08-11T18:20:00.948Z"
    },
    "updatedAt": {
      "$date": "2024-08-11T18:20:00.948Z"
    },
    "__v": 0
  },
  {
    "_id": {
      "$oid": "66b9012e16cc840f1c66c5f7"
    },
    "owner": {
      "$oid": "66a416a84da064e1d8fe6b0d"
    },
    "name": "Cozy Downtown Loft",
    "type": "Apartment",
    "description": "A cozy downtown loft with great city views.",
    "location": {
      "street": "45 Main Street",
      "city": "New York",
      "state": "NY",
      "zipcode": "100001"
    },
    "beds": 1,
    "baths": 1,
    "square_feet": 1800,
    "amenities": [
      "Wifi",
      "Full Kitchen",
      "Washer & Dryer",
      "Free Parking",
      "Swimming Pool",
      "Hot Tub",
      "24/7 Security",
      "Wheelchair Accessible",
      "Elevator Access",
      "Dishwasher",
      "Gym/Fitness Center",
      "Air Conditioning",
      "Balcony/Patio",
      "Smart TV"
    ],
    "rates": {
      "nightly": null,
      "weekly": 1000,
      "monthly": 4000
    },
    "seller_info": {
      "name": "Jane Smith",
      "email": "jane@gmail.com",
      "phone": "212-555-5555"
    },
    "images": [
      "https://res.cloudinary.com/dlleddoro/image/upload/v1723400493/InTheMarket/bz7mhs9v4glw45wvtabv.jpg",
      "https://res.cloudinary.com/dlleddoro/image/upload/v1723400493/InTheMarket/cyynywmc0nacmqzsgpfr.jpg",
      "https://res.cloudinary.com/dlleddoro/image/upload/v1723400494/InTheMarket/esvieimljae9t85ophnx.jpg"
    ],
    "is_featured": false,
    "createdAt": {
      "$date": "2024-08-11T18:21:34.757Z"
    },
    "updatedAt": {
      "$date": "2024-08-11T18:21:34.757Z"
    },
    "__v": 0
  },
  {
    "_id": {
      "$oid": "66b9019116cc840f1c66c5ff"
    },
    "owner": {
      "$oid": "66a416a84da064e1d8fe6b0d"
    },
    "name": "Luxury Condo with a View",
    "type": "Apartment",
    "description": "Experience luxury in this stunning condo with breathtaking views.",
    "location": {
      "street": "619060 Lux Lane",
      "city": "Los Angeles",
      "state": "CA",
      "zipcode": "900001"
    },
    "beds": 3,
    "baths": 2,
    "square_feet": 2200,
    "amenities": [
      "Full Kitchen",
      "Washer & Dryer",
      "Swimming Pool",
      "Hot Tub",
      "Wheelchair Accessible",
      "Elevator Access",
      "Gym/Fitness Center",
      "Air Conditioning",
      "Smart TV",
      "Coffee Maker"
    ],
    "rates": {
      "weekly": 200,
      "monthly": 750,
      "nightly": null
    },
    "seller_info": {
      "name": "David Johnson",
      "email": "david@gmail.com",
      "phone": "213-555-556"
    },
    "images": [
      "https://res.cloudinary.com/dlleddoro/image/upload/v1723400591/InTheMarket/xrtxz7ef76o3usu436ss.jpg",
      "https://res.cloudinary.com/dlleddoro/image/upload/v1723400592/InTheMarket/i7pzacanlyksw09kzh2q.jpg",
      "https://res.cloudinary.com/dlleddoro/image/upload/v1723400593/InTheMarket/adorxv7tyxlxvq5mwxdv.jpg",
      "https://res.cloudinary.com/dlleddoro/image/upload/v1723400593/InTheMarket/piwasbxfz7tian7j1vi7.jpg"
    ],
    "is_featured": true,
    "createdAt": {
      "$date": "2024-08-11T18:23:13.974Z"
    },
    "updatedAt": {
      "$date": "2024-08-13T20:52:39.212Z"
    },
    "__v": 0
  },
  {
    "_id": {
      "$oid": "66bf314cf407cda2dbabfd22"
    },
    "owner": {
      "$oid": "66a416a84da064e1d8fe6b1d"
    },
    "name": "Aravind",
    "type": "Studio",
    "description": "Beautiful Studio",
    "location": {
      "street": "83 Norfolk Street",
      "city": "Swansea",
      "state": "Wales",
      "zipcode": "SA1 6JE"
    },
    "beds": 1,
    "baths": 1,
    "square_feet": 1000,
    "amenities": [
      "Wifi",
      "Swimming Pool",
      "Hot Tub",
      "24/7 Security",
      "Elevator Access",
      "Dishwasher",
      "Gym/Fitness Center",
      "Air Conditioning",
      "Smart TV",
      "Coffee Maker"
    ],
    "rates": {
      "weekly": 68,
      "monthly": 7,
      "nightly": null
    },
    "seller_info": {
      "name": "Nevada Kemp",
      "email": "fyhutoxik@mailinator.com",
      "phone": "+1 (773) 984-6675"
    },
    "images": [
      "https://res.cloudinary.com/dlleddoro/image/upload/v1723806025/InTheMarket/tfa20p8plesbctvthe2p.jpg",
      "https://res.cloudinary.com/dlleddoro/image/upload/v1723806026/InTheMarket/pikonmw7qrmby47ingtd.jpg",
      "https://res.cloudinary.com/dlleddoro/image/upload/v1723806027/InTheMarket/onvamykvaybsynz1s7zl.jpg",
      "https://res.cloudinary.com/dlleddoro/image/upload/v1723806028/InTheMarket/v46nl2g2ec7oyd0g3tgl.jpg"
    ],
    "is_featured": true,
    "createdAt": {
      "$date": "2024-08-16T11:00:28.584Z"
    },
    "updatedAt": {
      "$date": "2024-08-16T14:40:15.455Z"
    },
    "__v": 0
  }]

// Assuming PropertySchema is already defined as provided

// Function to calculate the priority score for each property
function calculatePriorityScore(property, userPreferences) {
  let score = 0;

  // Example scoring logic
  if (property.beds >= userPreferences.minBeds) score += userPreferences.bedsWeight;
  if (property.baths >= userPreferences.minBaths) score += userPreferences.bathsWeight;
  if (property.square_feet >= userPreferences.minSquareFeet) score += userPreferences.squareFeetWeight;

  if (userPreferences.amenities) {
    userPreferences.amenities.forEach(amenity => {
      if (property.amenities.includes(amenity)) {
        score += userPreferences.amenitiesWeight;
      }
    });
  }

  // Example for location-based scoring, adjust according to your needs
  if (property.location.city === userPreferences.preferredCity) {
    score += userPreferences.locationWeight;
  }

  // Price-based scoring (lower price might give higher score)
  if (property.rates && property.rates.nightly) {
    score += (1 / property.rates.nightly) * userPreferences.priceWeight;
  }

  return score;
}

// Priority Queue Implementation
class PriorityQueue {
  constructor() {
    this.heap = [];
  }

  insert(property) {
    this.heap.push(property);
    this.bubbleUp(this.heap.length - 1);
  }

  bubbleUp(index) {
    while (index > 0) {
      let parentIndex = Math.floor((index - 1) / 2);
      if (this.heap[parentIndex].priorityScore >= this.heap[index].priorityScore) break;
      [this.heap[parentIndex], this.heap[index]] = [this.heap[index], this.heap[parentIndex]];
      index = parentIndex;
    }
  }

  extractMax() {
    if (this.heap.length === 1) return this.heap.pop();
    const max = this.heap[0];
    this.heap[0] = this.heap.pop();
    this.bubbleDown(0);
    return max;
  }

  bubbleDown(index) {
    const length = this.heap.length;
    while (true) {
      let left = 2 * index + 1;
      let right = 2 * index + 2;
      let largest = index;

      if (left < length && this.heap[left].priorityScore > this.heap[largest].priorityScore) {
        largest = left;
      }

      if (right < length && this.heap[right].priorityScore > this.heap[largest].priorityScore) {
        largest = right;
      }

      if (largest === index) break;

      [this.heap[largest], this.heap[index]] = [this.heap[index], this.heap[largest]];
      index = largest;
    }
  }

  isEmpty() {
    return this.heap.length === 0;
  }
}

// Example user preferences
const userPreferences = {
  minBeds: 3,
  minBaths:12 ,
  minSquareFeet: 1000,
  amenities: ["pool", "gym"],
  preferredCity: "New York",
  bedsWeight: 0.3,
  bathsWeight: 0.5,
  squareFeetWeight: 0.2,
  amenitiesWeight: 0.1,
  locationWeight: 0.1,
  priceWeight: 0.2,
};

// Example query to get properties from the database
async function getProperties() {
  // Fetch properties from the database
  const properties = propertiesData;  // Use .lean() for faster read-only queries

  // Initialize priority queue
  const pq = new PriorityQueue();

  // Calculate priority score for each property and insert into priority queue
  properties.forEach(property => {
    property.priorityScore = calculatePriorityScore(property, userPreferences);
    pq.insert(property);
  });

  // Extract properties in order of priority
  const sortedProperties = [];
  while (!pq.isEmpty()) {
    sortedProperties.push(pq.extractMax());
  }

  console.log(sortedProperties)
  return sortedProperties;
}

// Example usage
getProperties().then(sortedProperties => {
  console.log("Properties sorted by priority:", sortedProperties);
});
